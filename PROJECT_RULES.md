# 项目开发规则

## 核心原则

### 1. 模块化开发
- **单一职责原则**：每个文件只负责一个核心功能
- **独立可测试**：模块可以单独测试和使用
- **低耦合**：模块间依赖最小化，通过接口交互

### 2. 避免大文件
- **文件大小限制**：单个Python文件不超过500行
- **拆分时机**：当文件超过300行或包含多个独立功能时，立即拆分
- **拆分策略**：按功能、按业务逻辑、按技术领域拆分

## 文件结构规范

### 主文件结构
```
项目根目录/
├── main.py              # 主入口文件（<200行）
├── core/               # 核心功能模块
│   ├── image_gen.py    # 图片生成核心逻辑
│   ├── api_client.py   # API客户端
│   └── config.py       # 配置管理
├── ui/                 # UI相关模块
│   ├── webui.py        # Web界面
│   └── cli.py          # 命令行界面
├── utils/              # 工具函数
│   ├── logger.py       # 日志工具
│   └── file_utils.py   # 文件操作工具
└── tests/              # 测试模块
    ├── test_image_gen.py
    └── test_api_client.py
```

### 模块拆分示例

**反例**：一个1000行的`app.py`包含所有功能
**正例**：拆分为多个独立模块
- `app.py` - 主入口（<100行）
- `image_generator.py` - 图片生成逻辑
- `api_handler.py` - API请求处理
- `ui_manager.py` - UI管理
- `config_loader.py` - 配置加载

## 代码规范

### 1. 函数和类
- **函数大小**：单个函数不超过50行
- **类大小**：单个类不超过200行，不超过10个方法
- **参数限制**：函数参数不超过5个

### 2. 导入规范
- **显式导入**：避免`from module import *`
- **导入顺序**：标准库 → 第三方库 → 本地模块
- **导入分组**：用空行分隔不同类型的导入

### 3. 命名规范
- **模块名**：小写字母，下划线分隔（如`image_gen.py`）
- **类名**：大驼峰命名（如`ImageGenerator`）
- **函数名**：小写字母，下划线分隔（如`generate_image`）
- **常量名**：全大写，下划线分隔（如`API_TIMEOUT`）

## 大文件预防措施

### 1. 定期检查
- 每周检查一次文件大小
- 对超过300行的文件进行评估

### 2. 自动化检测
```python
# 可以添加到CI/CD中的检测脚本
import os
import sys

MAX_FILE_SIZE = 500  # 行

def check_file_sizes():
    for root, dirs, files in os.walk('.'):
        for file in files:
            if file.endswith('.py'):
                file_path = os.path.join(root, file)
                with open(file_path, 'r', encoding='utf-8') as f:
                    lines = len(f.readlines())
                    if lines > MAX_FILE_SIZE:
                        print(f"警告: {file_path} 有 {lines} 行，超过阈值 {MAX_FILE_SIZE}")
                        return False
    return True

if __name__ == '__main__':
    if not check_file_sizes():
        sys.exit(1)
```

### 3. 重构流程
1. **识别问题**：发现大文件或复杂模块
2. **分析依赖**：理清模块间的依赖关系
3. **拆分设计**：设计新的模块结构
4. **逐步迁移**：将功能逐步迁移到新模块
5. **测试验证**：确保拆分后功能正常

## 版本控制规则

### 1. 提交规范
- **小提交**：每次提交只包含一个功能或修复
- **清晰描述**：提交信息明确说明修改内容
- **关联问题**：如果修复问题，在提交信息中关联问题编号

### 2. 分支策略
- `main`：主分支，稳定版本
- `develop`：开发分支，日常开发
- `feature/*`：功能分支，新功能开发
- `bugfix/*`：修复分支，bug修复

## 代码审查标准

### 1. 必查项
- 文件大小是否符合规范
- 模块拆分是否合理
- 函数和类是否单一职责
- 导入是否规范

### 2. 加分项
- 模块有清晰的文档字符串
- 有单元测试
- 代码注释清晰
- 错误处理完善

## 例外情况

### 允许大文件的场景
- **配置文件**：如包含大量配置项的JSON/YAML文件
- **数据文件**：如包含训练数据或测试数据的文件
- **生成文件**：如自动生成的API包装器或文档

### 审批流程
- 当必须创建大文件时，需要团队负责人审批
- 必须在文件头部添加说明，解释为什么需要大文件

---

**最后更新**: 2026-02-09
**版本**: 1.0.0